<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì“°ë ˆê¸°í†µ ê´€ë¦¬ ì§€ë„</title>
  <style>
    :root {
      --primary-color: #2c3e50;
      --secondary-color: #3498db;
      --success-color: #2ecc71;
      --warning-color: #f39c12;
      --danger-color: #e74c3c;
      --light-gray: #f5f5f5;
      --dark-gray: #333;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'ë§‘ì€ ê³ ë”•', sans-serif;
      background-color: var(--light-gray);
      color: var(--dark-gray);
      line-height: 1.6;
      margin: 0;
      padding: 0;
      height: 100vh;
      overflow: hidden;
    }

    .admin-header {
      background-color: var(--primary-color);
      color: white;
      padding: 15px 0;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      margin-bottom: 30px;
    }

    .header-content {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .nav-menu {
      display: flex;
      gap: 20px;
      margin-left: 20px;
    }

    .nav-item {
      color: white;
      text-decoration: none;
      padding: 8px 15px;
      border-radius: 5px;
      transition: background-color 0.3s;
    }

    .nav-item:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .nav-item.active {
      background-color: var(--secondary-color);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo h1 {
      font-size: 1.8em;
      margin: 0;
    }

    .admin-info {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .admin-badge {
      background-color: var(--secondary-color);
      padding: 5px 10px;
      border-radius: 15px;
      font-size: 0.9em;
    }

    .logout-btn {
      background-color: var(--danger-color);
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s;
      text-decoration: none;
      display: inline-block;
    }

    .logout-btn:hover {
      background-color: #c0392b;
    }

    .container {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      display: flex;
      position: relative;
    }

    #map {
      height: 100%;
      width: 100%;
      border-radius: 0;
      box-shadow: none;
      margin: 0;
    }

    .map-controls {
      position: absolute;
      top: 20px;
      right: 20px;
      display: flex;
      gap: 10px;
      z-index: 1000;
    }

    .control-btn {
      background: white;
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      font-size: 20px;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.3s;
    }

    .control-btn:hover {
      background: #f5f5f5;
    }

    .info-btn {
      background-color: var(--secondary-color);
      color: white;
    }

    .alarm-btn {
      background-color: var(--warning-color);
      color: white;
    }

    .info-modal {
      position: absolute;
      top: 70px;
      right: 70px;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      z-index: 1000;
      width: 300px;
      display: none;
    }

    .toggle-container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 15px;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 5px;
    }

    .toggle-label {
      font-size: 0.9em;
      color: var(--primary-color);
    }

    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 24px;
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked + .toggle-slider {
      background-color: var(--secondary-color);
    }

    input:checked + .toggle-slider:before {
      transform: translateX(26px);
    }

    .density-legend {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #eee;
    }

    .density-item {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
    }

    .density-color {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      margin-right: 10px;
    }

    .density-text {
      font-size: 0.9em;
    }

    .info-modal.show {
      display: block;
    }

    .alarm-history {
      position: absolute;
      top: 0;
      right: 0;
      width: 300px;
      background: white;
      padding: 20px;
      border-radius: 0 0 0 10px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      height: 100%;
      overflow-y: auto;
      transform: translateX(100%);
      transition: transform 0.3s ease;
      z-index: 1000;
    }

    .alarm-history.show {
      transform: translateX(0);
    }

    .alarm-title {
      font-weight: bold;
      color: var(--primary-color);
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
    }

    .alarm-item {
      padding: 10px;
      border-bottom: 1px solid #eee;
      font-size: 0.9em;
    }

    .alarm-item:last-child {
      border-bottom: none;
    }

    .alarm-time {
      color: #666;
      font-size: 0.8em;
      margin-bottom: 5px;
    }

    .alarm-content {
      margin-bottom: 5px;
    }

    .alarm-status {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 0.8em;
      font-weight: bold;
    }

    .alarm-critical { background-color: var(--danger-color); color: white; }
    .alarm-warning { background-color: var(--warning-color); color: white; }
    .alarm-info { background-color: var(--secondary-color); color: white; }

    .legend {
      background: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
    }

    .legend-title {
      font-weight: bold;
      margin-bottom: 10px;
      color: var(--primary-color);
    }

    .legend-item {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
    }

    .legend-color {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      margin-right: 10px;
    }

    .legend-text {
      font-size: 0.9em;
    }

    .info-window {
      padding: 10px;
    }

    .info-window-title {
      font-weight: bold;
      margin-bottom: 5px;
      color: var(--primary-color);
    }

    .info-window-content {
      font-size: 0.9em;
    }

    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: bold;
      color: white;
      text-align: center;
      min-width: 80px;
      margin-top: 5px;
    }

    .status-working { background-color: var(--success-color); }
    .status-waiting { background-color: var(--warning-color); }
    .status-vacation { background-color: var(--danger-color); }

    .deployment-status {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: bold;
      color: white;
      text-align: center;
      min-width: 100px;
      margin-top: 5px;
    }

    .deployment-needed { background-color: var(--danger-color); }
    .deployment-not-needed { background-color: var(--success-color); }
    .deployment-completed { background-color: var(--warning-color); }

    .checkbox-group {
      margin: 15px 0;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 5px;
    }

    .checkbox-item {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }

    .checkbox-item:last-child {
      margin-bottom: 0;
    }

    .checkbox-label {
      display: flex;
      align-items: center;
      cursor: pointer;
      font-size: 0.9em;
      color: var(--primary-color);
    }

    .checkbox-label input {
      margin-right: 10px;
    }

    .status-indicator {
      width: 15px;
      height: 15px;
      border-radius: 50%;
      margin-right: 10px;
    }

    .status-normal { background-color: #2ecc71; }
    .status-warning { background-color: #f39c12; }
    .status-critical { background-color: #e74c3c; }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      background-color: white;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      margin-bottom: 20px;
      border-radius: 10px;
    }

    .header-title {
      font-size: 1.5em;
      font-weight: bold;
      color: var(--primary-color);
    }

    .logout-button {
      padding: 8px 20px;
      background-color: var(--danger-color);
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.9em;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .logout-button:hover {
      background-color: #c0392b;
      transform: translateY(-2px);
    }

    .logout-icon {
      font-size: 1.1em;
    }
  </style>
</head>
<body>
  <header class="admin-header">
    <div class="header-content">
      <div class="logo">
        <h1>ì“°ë ˆê¸°í†µ ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
      </div>
      <div class="nav-menu">
        <a href="trash-map.html" class="nav-item active" id="mapNav">ì§€ë„</a>
        <a href="trash-management.html" class="nav-item" id="trashNav">ì“°ë ˆê¸°í†µ ê´€ë¦¬</a>
        <a href="cleaner-management.html" class="nav-item" id="cleanerNav">ë¯¸í™”ì› ê´€ë¦¬</a>
      </div>
      <div class="admin-info">
        <span class="admin-badge">ê´€ë¦¬ì</span>
        <button class="logout-btn" onclick="window.location.href='index.html'">ë¡œê·¸ì•„ì›ƒ</button>
      </div>
    </div>
  </header>

  <div class="container">
    <div style="position: relative; width: 100%; height: 100%;">
      <div class="map-controls">
        <button class="control-btn info-btn" onclick="toggleInfo()">!</button>
        <button class="control-btn alarm-btn" onclick="toggleAlarm()">ğŸ“‹</button>
      </div>
      <div class="info-modal" id="infoModal">
        <div class="legend-title">ì‚¬ìš© ì•ˆë‚´</div>
        
        <div class="toggle-container">
          <span class="toggle-label">ë¯¸í™”ì› í‘œì‹œ</span>
          <label class="toggle-switch">
            <input type="checkbox" id="cleanerToggle" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>

        <div class="toggle-container">
          <span class="toggle-label">ì“°ë ˆê¸°í†µ ìƒíƒœ</span>
          <label class="toggle-switch">
            <input type="checkbox" id="trashToggle" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>

        <div class="checkbox-group" id="trashStatusGroup">
          <div class="checkbox-item">
            <label class="checkbox-label">
              <input type="checkbox" id="trashNormal" checked>
              <span class="status-indicator status-normal"></span>
              ì •ìƒ (50% ë¯¸ë§Œ)
            </label>
          </div>
          <div class="checkbox-item">
            <label class="checkbox-label">
              <input type="checkbox" id="trashWarning" checked>
              <span class="status-indicator status-warning"></span>
              ì£¼ì˜ (50% ì´ìƒ 90% ë¯¸ë§Œ)
            </label>
          </div>
          <div class="checkbox-item">
            <label class="checkbox-label">
              <input type="checkbox" id="trashCritical" checked>
              <span class="status-indicator status-critical"></span>
              ê¸´ê¸‰ (90% ì´ìƒ)
            </label>
          </div>
        </div>

        <div class="toggle-container">
          <span class="toggle-label">ì¸êµ¬ ë°€ì§‘ë„</span>
          <label class="toggle-switch">
            <input type="checkbox" id="densityToggle" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>

        <div class="density-legend">
          <div class="legend-title">ì¸êµ¬ ë°€ì§‘ë„ êµ¬ë¶„</div>
          <div class="density-item">
            <div class="density-color" style="background-color: #2ecc71;"></div>
            <div class="density-text">10% ì´ìƒ (ì •ìƒ)</div>
          </div>
          <div class="density-item">
            <div class="density-color" style="background-color: #f39c12;"></div>
            <div class="density-text">30% ì´ìƒ (ê´€ì‹¬)</div>
          </div>
          <div class="density-item">
            <div class="density-color" style="background-color: #e74c3c;"></div>
            <div class="density-text">50% ì´ìƒ (ê²½ê³ )</div>
          </div>
        </div>
      </div>
      <div id="map"></div>
    </div>

    <div class="alarm-history" id="alarmHistory">
      <div class="alarm-title">ì•ŒëŒ íˆìŠ¤í† ë¦¬</div>
      <div id="alarmList">
        <div class="alarm-item">
          <div class="alarm-time">2024-03-20 14:30</div>
          <div class="alarm-content">ê°•ë‚¨ì—­ ì• ì“°ë ˆê¸°í†µ ì±„ì›€ë¥  95% ë„ë‹¬</div>
          <span class="alarm-status alarm-critical">ê¸´ê¸‰</span>
        </div>
        <div class="alarm-item">
          <div class="alarm-time">2024-03-20 13:45</div>
          <div class="alarm-content">í™ëŒ€ì…êµ¬ì—­ ì• ì“°ë ˆê¸°í†µ ì±„ì›€ë¥  88% ë„ë‹¬</div>
          <span class="alarm-status alarm-warning">ì£¼ì˜</span>
        </div>
        <div class="alarm-item">
          <div class="alarm-time">2024-03-20 12:15</div>
          <div class="alarm-content">ê¹€ë¯¸í™” ë‹˜ì´ ê°•ë‚¨êµ¬ ë°°ì¹˜ ì™„ë£Œ</div>
          <span class="alarm-status alarm-info">ì •ë³´</span>
        </div>
        <div class="alarm-item">
          <div class="alarm-time">2024-03-20 11:30</div>
          <div class="alarm-content">ì´íƒœì› ì“°ë ˆê¸°í†µ ì±„ì›€ë¥  92% ë„ë‹¬</div>
          <span class="alarm-status alarm-critical">ê¸´ê¸‰</span>
        </div>
        <div class="alarm-item">
          <div class="alarm-time">2024-03-20 10:45</div>
          <div class="alarm-content">ì„±ìˆ˜ì—­ ì• ì“°ë ˆê¸°í†µ ì±„ì›€ë¥  85% ë„ë‹¬</div>
          <span class="alarm-status alarm-warning">ì£¼ì˜</span>
        </div>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script>
    // ì“°ë ˆê¸°í†µ ë°ì´í„°
    const trashData = [
      {district:'ê°•ë‚¨êµ¬', address:'ê°•ë‚¨ì—­ ì•', fill:35, lat:37.4979, lng:127.0276},
      {district:'ê´€ì•…êµ¬', address:'ì‹ ë¦¼ì—­ ì•', fill:58, lat:37.4843, lng:126.9295},
      {district:'ì˜ë“±í¬êµ¬', address:'ëŒ€ë¦¼ì—­ ì•', fill:92, lat:37.4924, lng:126.8955},
      {district:'ë§ˆí¬êµ¬', address:'í™ëŒ€ì…êµ¬ì—­ ì•', fill:45, lat:37.5572, lng:126.9236},
      {district:'ì¤‘êµ¬', address:'ëª…ë™ì—­ ì•', fill:78, lat:37.5639, lng:126.9839},
      {district:'ìš©ì‚°êµ¬', address:'ì„œìš¸ì—­ ì•', fill:67, lat:37.5537, lng:126.9696},
      {district:'ì†¡íŒŒêµ¬', address:'ì ì‹¤ì—­ ì•', fill:88, lat:37.5133, lng:127.1001},
      {district:'ì„±ë™êµ¬', address:'ê±´ëŒ€ì…êµ¬ì—­ ì•', fill:40, lat:37.5407, lng:127.0702},
      {district:'ì„œì´ˆêµ¬', address:'ì„œìš¸ëŒ€ì…êµ¬ì—­ ì•', fill:95, lat:37.4812, lng:126.9527},
      {district:'ê°•ì„œêµ¬', address:'ì„œìš¸ì‹ë¬¼ì› ì•', fill:25, lat:37.5683, lng:126.8970},
      {district:'ê°•ë‚¨êµ¬', address:'ì‹ ì‚¬ì—­ ì•', fill:65, lat:37.5162, lng:127.0201},
      {district:'ê°•ë‚¨êµ¬', address:'ì••êµ¬ì •ì—­ ì•', fill:72, lat:37.5271, lng:127.0285},
      {district:'ê´€ì•…êµ¬', address:'ë´‰ì²œì—­ ì•', fill:48, lat:37.4825, lng:126.9419},
      {district:'ì˜ë“±í¬êµ¬', address:'ì˜ë“±í¬ì—­ ì•', fill:82, lat:37.5157, lng:126.9077},
      {district:'ë§ˆí¬êµ¬', address:'í•©ì •ì—­ ì•', fill:55, lat:37.5495, lng:126.9137},
      {district:'ì¤‘êµ¬', address:'ì‹œì²­ì—­ ì•', fill:68, lat:37.5653, lng:126.9770},
      {district:'ìš©ì‚°êµ¬', address:'ì´íƒœì›ì—­ ì•', fill:75, lat:37.5345, lng:126.9943},
      {district:'ì†¡íŒŒêµ¬', address:'ì„ì´Œì—­ ì•', fill:62, lat:37.5055, lng:127.1069},
      {district:'ì„±ë™êµ¬', address:'ëšì„¬ì—­ ì•', fill:85, lat:37.5471, lng:127.0476},
      {district:'ì„œì´ˆêµ¬', address:'êµëŒ€ì—­ ì•', fill:52, lat:37.4934, lng:127.0141},
      {district:'ê°•ì„œêµ¬', address:'ê³µí•­ì‹œì¥ ì•', fill:38, lat:37.5623, lng:126.8125},
      {district:'ê°•ë‚¨êµ¬', address:'ì‚¼ì„±ì—­ ì•', fill:71, lat:37.5088, lng:127.0630},
      {district:'ê´€ì•…êµ¬', address:'ì„œìš¸ëŒ€ì…êµ¬ì—­ ì•', fill:59, lat:37.4812, lng:126.9527},
      {district:'ì˜ë“±í¬êµ¬', address:'ì—¬ì˜ë„ì—­ ì•', fill:83, lat:37.5219, lng:126.9242},
      {district:'ë§ˆí¬êµ¬', address:'ê³µë•ì—­ ì•', fill:47, lat:37.5444, lng:126.9516},
      {district:'ì¤‘êµ¬', address:'ë™ëŒ€ë¬¸ì—­ ì•', fill:64, lat:37.5663, lng:127.0097},
      {district:'ìš©ì‚°êµ¬', address:'í•œê°•ì§„ì—­ ì•', fill:77, lat:37.5398, lng:126.9999},
      {district:'ì†¡íŒŒêµ¬', address:'ê°€ë½ì‹œì¥ ì•', fill:91, lat:37.4932, lng:127.1181},
      {district:'ì„±ë™êµ¬', address:'ì„±ìˆ˜ì—­ ì•', fill:43, lat:37.5446, lng:127.0560},
      {district:'ì„œì´ˆêµ¬', address:'ë°©ë°°ì—­ ì•', fill:56, lat:37.4814, lng:126.9976}
    ];

    // ë¯¸í™”ì› ë°ì´í„°
    const cleanerData = [
      {name:'ê¹€ë¯¸í™”', phone:'010-1111-2222', district:'ê°•ë‚¨êµ¬', status:'ê·¼ë¬´ëŒ€ê¸°', lat:37.4979, lng:127.0276},
      {name:'ì´ì •í™”', phone:'010-2222-3333', district:'ê´€ì•…êµ¬', status:'ê·¼ë¬´ì¤‘', lat:37.4843, lng:126.9295},
      {name:'ë°•ì²­ì†Œ', phone:'010-3333-4444', district:'ì˜ë“±í¬êµ¬', status:'ê·¼ë¬´ì¤‘', lat:37.4924, lng:126.8955},
      {name:'ìµœí˜„ì¥', phone:'010-4444-5555', district:'ë§ˆí¬êµ¬', status:'íœ´ê°€', lat:37.5572, lng:126.9236},
      {name:'ì¥í˜„ìˆ™', phone:'010-5555-6666', district:'ì¤‘êµ¬', status:'ê·¼ë¬´ëŒ€ê¸°', lat:37.5639, lng:126.9839},
      {name:'ì •ì„±ì‹¤', phone:'010-6666-7777', district:'ìš©ì‚°êµ¬', status:'ê·¼ë¬´ì¤‘', lat:37.5537, lng:126.9696},
      {name:'í•œê°•ë¯¸', phone:'010-7777-8888', district:'ì†¡íŒŒêµ¬', status:'ê·¼ë¬´ì¤‘', lat:37.5133, lng:127.1001},
      {name:'ê°•ì •ë¦¬', phone:'010-8888-9999', district:'ì„±ë™êµ¬', status:'ê·¼ë¬´ì¤‘', lat:37.5407, lng:127.0702},
      {name:'ë¬¸ì²­ì†Œ', phone:'010-9999-0000', district:'ì„œì´ˆêµ¬', status:'ê·¼ë¬´ëŒ€ê¸°', lat:37.4812, lng:126.9527},
      {name:'ë‚¨ìˆœì •', phone:'010-0000-1234', district:'ê°•ì„œêµ¬', status:'ê·¼ë¬´ì¤‘', lat:37.5683, lng:126.8970},
      {name:'ì˜¤ì •í™”', phone:'010-1234-5678', district:'ê°•ë‚¨êµ¬', status:'ê·¼ë¬´ì¤‘', lat:37.5162, lng:127.0201},
      {name:'ìœ ì²­ì†Œ', phone:'010-2345-6789', district:'ê´€ì•…êµ¬', status:'ê·¼ë¬´ëŒ€ê¸°', lat:37.4825, lng:126.9419},
      {name:'ë°±í˜„ì¥', phone:'010-3456-7890', district:'ì˜ë“±í¬êµ¬', status:'ê·¼ë¬´ì¤‘', lat:37.5157, lng:126.9077},
      {name:'ì‹ ë¯¸í™”', phone:'010-4567-8901', district:'ë§ˆí¬êµ¬', status:'íœ´ê°€', lat:37.5495, lng:126.9137},
      {name:'ì¡°ì •ë¦¬', phone:'010-5678-9012', district:'ì¤‘êµ¬', status:'ê·¼ë¬´ì¤‘', lat:37.5653, lng:126.9770},
      {name:'ì„ì„±ì‹¤', phone:'010-6789-0123', district:'ìš©ì‚°êµ¬', status:'ê·¼ë¬´ëŒ€ê¸°', lat:37.5345, lng:126.9943},
      {name:'ì „ê°•ë¯¸', phone:'010-7890-1234', district:'ì†¡íŒŒêµ¬', status:'ê·¼ë¬´ì¤‘', lat:37.5055, lng:127.1069},
      {name:'ì§„í˜„ìˆ™', phone:'010-8901-2345', district:'ì„±ë™êµ¬', status:'ê·¼ë¬´ì¤‘', lat:37.5471, lng:127.0476},
      {name:'ì²œì²­ì†Œ', phone:'010-9012-3456', district:'ì„œì´ˆêµ¬', status:'ê·¼ë¬´ëŒ€ê¸°', lat:37.4934, lng:127.0141},
      {name:'ê¸°ì •í™”', phone:'010-0123-4567', district:'ê°•ì„œêµ¬', status:'ê·¼ë¬´ì¤‘', lat:37.5623, lng:126.8125}
    ];

    // ì¸êµ¬ ë°€ì§‘ ì§€ì—­ ë°ì´í„°
    const crowdedAreas = [
      {name: 'ê°•ë‚¨ì—­', lat: 37.4979, lng: 127.0276, radius: 500, density: 60, color: '#e74c3c'},
      {name: 'ì´íƒœì›', lat: 37.5345, lng: 126.9943, radius: 400, density: 55, color: '#e74c3c'},
      {name: 'ìš©ì‚°ì—­', lat: 37.5537, lng: 126.9696, radius: 400, density: 35, color: '#f39c12'},
      {name: 'í™ëŒ€ì…êµ¬', lat: 37.5572, lng: 126.9236, radius: 500, density: 65, color: '#e74c3c'},
      {name: 'ì„±ìˆ˜', lat: 37.5471, lng: 127.0476, radius: 400, density: 40, color: '#f39c12'},
      {name: 'ë™ëŒ€ë¬¸', lat: 37.5663, lng: 127.0097, radius: 400, density: 15, color: '#2ecc71'}
    ];

    // ì§€ë„ ì´ˆê¸°í™”
    const map = L.map('map').setView([37.5665, 126.9780], 12);

    // OpenStreetMap íƒ€ì¼ ë ˆì´ì–´ ì¶”ê°€
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // ì¤Œ ë ˆë²¨ ë³€ê²½ ì´ë²¤íŠ¸ ì²˜ë¦¬
    map.on('zoomend', function() {
      const currentZoom = map.getZoom();
      const minZoomForTrash = 13; // ì“°ë ˆê¸°í†µì´ í‘œì‹œë˜ê¸° ì‹œì‘í•˜ëŠ” ìµœì†Œ ì¤Œ ë ˆë²¨

      // ì“°ë ˆê¸°í†µ ë§ˆì»¤ë§Œ ì¤Œ ë ˆë²¨ì— ë”°ë¼ í‘œì‹œ/ìˆ¨ê¹€ ì²˜ë¦¬
      trashMarkers.forEach(marker => {
        if (currentZoom >= minZoomForTrash) {
          if (!map.hasLayer(marker)) {
            marker.addTo(map);
          }
        } else {
          if (map.hasLayer(marker)) {
            marker.remove();
          }
        }
      });

      // ë¯¸í™”ì› ë§ˆì»¤ëŠ” í•­ìƒ í‘œì‹œ
      cleanerMarkers.forEach(marker => {
        if (!map.hasLayer(marker)) {
          marker.addTo(map);
        }
      });
    });

    // ì¸êµ¬ ë°€ì§‘ ì§€ì—­ í‘œì‹œ
    let densityCircles = [];
    crowdedAreas.forEach(area => {
      const circle = L.circle([area.lat, area.lng], {
        radius: area.radius,
        color: area.color,
        fillColor: area.color,
        fillOpacity: 0.1,
        weight: 2
      }).addTo(map).bindPopup(`
        <div class="info-window">
          <div class="info-window-title">${area.name}</div>
          <div class="info-window-content">
            <div>ì¸êµ¬ ë°€ì§‘ë„: ${area.density}%</div>
            <div>${area.density >= 50 ? 'ê²½ê³ ' : area.density >= 30 ? 'ê´€ì‹¬' : 'ì •ìƒ'} ì§€ì—­</div>
          </div>
        </div>
      `);
      densityCircles.push(circle);
    });

    // ì“°ë ˆê¸°í†µ ë§ˆì»¤ ì¶”ê°€
    let trashMarkers = [];
    trashData.forEach(trash => {
      const fillColor = trash.fill >= 90 ? '#e74c3c' : 
                       trash.fill >= 50 ? '#f39c12' : '#2ecc71';
      
      // ë°°ì¹˜ ìƒíƒœ ê²°ì • (ì„ì˜ë¡œ ì„¤ì •)
      const deploymentStatus = Math.random() > 0.5 ? 'completed' : 'needed';
      const visitTime = Math.floor(Math.random() * 30) + 1; // 1~30ë¶„ ì‚¬ì´ ëœë¤ê°’
      const deploymentText = deploymentStatus === 'completed' ? `ë°°ì¹˜ ì™„ë£Œ (${visitTime}ë¶„ í›„ ë°©ë¬¸)` : 
                           trash.fill < 50 ? 'ë°°ì¹˜ ë¶ˆí•„ìš”' : `ë°©ë¬¸ì˜ˆì •ì‹œê°„ (${visitTime}ë¶„ í›„)`;
      const deploymentClass = deploymentStatus === 'completed' ? 'deployment-completed' : 
                            trash.fill < 50 ? 'deployment-not-needed' : 'deployment-needed';

      const icon = L.divIcon({
        className: 'trash-icon',
        html: `<div style="
          position: relative;
          background-color: ${fillColor}; 
          width: 24px; 
          height: 24px; 
          border-radius: 50%; 
          border: 2px solid white;
          box-shadow: 0 0 5px rgba(0,0,0,0.3);
          display: flex;
          align-items: center;
          justify-content: center;
          color: white;
          font-weight: bold;
          font-size: 10px;
        ">${trash.fill}%</div>`,
        iconSize: [24, 24],
        iconAnchor: [12, 12]
      });

      // ì“°ë ˆê¸°í†µ ìœ„ì¹˜ë¥¼ ì•½ê°„ ì¡°ì •
      const adjustedLat = trash.lat + (Math.random() * 0.0005 - 0.00025);
      const adjustedLng = trash.lng + (Math.random() * 0.0005 - 0.00025);

      const marker = L.marker([adjustedLat, adjustedLng], {
        icon: icon,
        title: `${trash.address} (${trash.fill}%)`,
        status: trash.fill >= 90 ? 'critical' : trash.fill >= 50 ? 'warning' : 'normal',
        deployment: deploymentStatus,
        visitTime: visitTime
      }).addTo(map);

      const popupContent = `
        <div class="info-window">
          <div class="info-window-title">${trash.address}</div>
          <div class="info-window-content">
            <div>ìì¹˜êµ¬: ${trash.district}</div>
            <div>ì±„ì›€ë¥ : ${trash.fill}%</div>
            <div>ë‚¨ì€ ìš©ëŸ‰: ${100 - trash.fill}%</div>
            <span class="deployment-status ${deploymentClass}">${deploymentText}</span>
          </div>
        </div>
      `;

      marker.bindPopup(popupContent);
      trashMarkers.push(marker);
    });

    // ê·¼ë¬´ì¤‘ì¸ ë¯¸í™”ì›ë§Œ ë§ˆì»¤ ì¶”ê°€
    let cleanerMarkers = [];
    const workingCleaners = cleanerData.filter(cleaner => cleaner.status === 'ê·¼ë¬´ì¤‘');
    workingCleaners.forEach(cleaner => {
      const statusColor = '#3498db';
      const statusText = 'ğŸ‘¤';

      const icon = L.divIcon({
        className: 'cleaner-icon',
        html: `<div style="
          position: relative;
          background-color: ${statusColor}; 
          width: 32px; 
          height: 32px; 
          border-radius: 50%; 
          border: 2px solid #3498db;
          box-shadow: 0 0 5px rgba(0,0,0,0.3);
          display: flex;
          align-items: center;
          justify-content: center;
          color: white;
          font-weight: bold;
          font-size: 18px;
        ">${statusText}</div>`,
        iconSize: [32, 32],
        iconAnchor: [16, 16]
      });

      // ë¯¸í™”ì› ìœ„ì¹˜ë¥¼ ì•½ê°„ ì¡°ì •
      const adjustedLat = cleaner.lat + (Math.random() * 0.0005 - 0.00025);
      const adjustedLng = cleaner.lng + (Math.random() * 0.0005 - 0.00025);

      const marker = L.marker([adjustedLat, adjustedLng], {
        icon: icon,
        title: `${cleaner.name} (ê·¼ë¬´ì¤‘)`
      }).addTo(map);

      const popupContent = `
        <div class="info-window">
          <div class="info-window-title">${cleaner.name}</div>
          <div class="info-window-content">
            <div>ì—°ë½ì²˜: ${cleaner.phone}</div>
            <div>ìì¹˜êµ¬: ${cleaner.district}</div>
            <span class="status-badge status-working">ê·¼ë¬´ì¤‘</span>
          </div>
        </div>
      `;

      marker.bindPopup(popupContent);
      cleanerMarkers.push(marker);
    });

    // URL íŒŒë¼ë¯¸í„°ì—ì„œ ìì¹˜êµ¬ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
    const urlParams = new URLSearchParams(window.location.search);
    const districtParam = urlParams.get('district');
    if (districtParam) {
      const districtData = trashData.find(trash => trash.district === districtParam);
      if (districtData) {
        map.setView([districtData.lat, districtData.lng], 14);
      }
    }

    // í† ê¸€ ê¸°ëŠ¥ êµ¬í˜„
    const cleanerToggle = document.getElementById('cleanerToggle');
    const trashToggle = document.getElementById('trashToggle');
    const densityToggle = document.getElementById('densityToggle');
    const trashNormal = document.getElementById('trashNormal');
    const trashWarning = document.getElementById('trashWarning');
    const trashCritical = document.getElementById('trashCritical');

    if (cleanerToggle) {
      cleanerToggle.addEventListener('change', function(e) {
        cleanerMarkers.forEach(marker => {
          if (e.target.checked) {
            marker.addTo(map);
          } else {
            marker.remove();
          }
        });
      });
    }

    if (trashToggle) {
      trashToggle.addEventListener('change', function(e) {
        const statusGroup = document.getElementById('trashStatusGroup');
        const checkboxes = statusGroup.querySelectorAll('input[type="checkbox"]');
        
        if (e.target.checked) {
          checkboxes.forEach(checkbox => checkbox.checked = true);
          updateTrashMarkers();
        } else {
          checkboxes.forEach(checkbox => checkbox.checked = false);
          trashMarkers.forEach(marker => marker.remove());
        }
      });
    }

    if (densityToggle) {
      densityToggle.addEventListener('change', function(e) {
        densityCircles.forEach(circle => {
          if (e.target.checked) {
            circle.addTo(map);
          } else {
            circle.remove();
          }
        });
      });
    }

    // ì“°ë ˆê¸°í†µ ìƒíƒœ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸ ì²˜ë¦¬
    if (trashNormal) trashNormal.addEventListener('change', updateTrashMarkers);
    if (trashWarning) trashWarning.addEventListener('change', updateTrashMarkers);
    if (trashCritical) trashCritical.addEventListener('change', updateTrashMarkers);

    function updateTrashMarkers() {
      const showNormal = trashNormal.checked;
      const showWarning = trashWarning.checked;
      const showCritical = trashCritical.checked;

      trashMarkers.forEach(marker => {
        const status = marker.options.status;
        if ((status === 'normal' && showNormal) ||
            (status === 'warning' && showWarning) ||
            (status === 'critical' && showCritical)) {
          marker.addTo(map);
        } else {
          marker.remove();
        }
      });
    }

    // ëª¨ë‹¬ í† ê¸€ ê¸°ëŠ¥
    const infoBtn = document.querySelector('.info-btn');
    const alarmBtn = document.querySelector('.alarm-btn');
    const infoModal = document.getElementById('infoModal');
    const alarmHistory = document.getElementById('alarmHistory');

    if (infoBtn) {
      infoBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        infoModal.classList.toggle('show');
      });
    }

    if (alarmBtn) {
      alarmBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        alarmHistory.classList.toggle('show');
      });
    }

    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    document.addEventListener('click', function(event) {
      if (infoModal && !infoModal.contains(event.target) && event.target !== infoBtn) {
        infoModal.classList.remove('show');
      }
      
      if (alarmHistory && !alarmHistory.contains(event.target) && event.target !== alarmBtn) {
        alarmHistory.classList.remove('show');
      }
    });

    // ë„¤ë¹„ê²Œì´ì…˜ ë©”ë‰´ ì´ë²¤íŠ¸ ì²˜ë¦¬
    const mapNav = document.getElementById('mapNav');
    const trashNav = document.getElementById('trashNav');
    const cleanerNav = document.getElementById('cleanerNav');

    if (mapNav) {
      mapNav.addEventListener('click', function() {
        setActiveNav('mapNav');
      });
    }

    if (trashNav) {
      trashNav.addEventListener('click', function() {
        setActiveNav('trashNav');
      });
    }

    if (cleanerNav) {
      cleanerNav.addEventListener('click', function() {
        setActiveNav('cleanerNav');
      });
    }

    function setActiveNav(navId) {
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
      });
      document.getElementById(navId).classList.add('active');
    }
  </script>
</body>
</html> 